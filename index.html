<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <title>GPS Tracker 2025</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- LIENS AVEC PROTOCOLE FORCE POUR EVITER L'ERREUR 404 GITHUB -->
    <link rel="stylesheet" href="unpkg.com" />
    <script src="unpkg.com"></script>

    <style>
        html, body { height: 100%; margin: 0; padding: 0; background: #e0e0e0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; z-index: 1; }
        .panel {
            position: absolute; top: 15px; left: 15px; z-index: 1000;
            background: white; padding: 15px; border-radius: 10px;
            font-family: sans-serif; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            width: 220px;
        }
        button { 
            width: 100%; padding: 12px; margin-top: 10px;
            background: #007bff; color: white; border: none;
            border-radius: 6px; font-weight: bold; cursor: pointer;
        }
        #status { font-size: 14px; font-weight: bold; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="panel">
    <div id="status">Chargement...</div>
    <div id="substatus" style="font-size: 12px; color: #666;">Initialisation de la carte</div>
    <button id="btn" onclick="lancerSuivi()">ACTIVER LE GPS</button>
</div>

<div id="map"></div>

<script>
    var map, route = [], polyline, marker;

    // 1. Initialisation s√©curis√©e
    window.onload = function() {
        if (typeof L === 'undefined') {
            document.getElementById('status').innerHTML = "‚ùå Erreur de chargement";
            document.getElementById('substatus').innerHTML = "La biblioth√®que Leaflet est bloqu√©e.";
            return;
        }

        document.getElementById('status').innerHTML = "‚úÖ Syst√®me pr√™t";
        document.getElementById('substatus').innerHTML = "Cliquez sur le bouton bleu";

        // Cr√©ation de la carte
        map = L.map('map', {zoomControl: false}).setView([48.8566, 2.3522], 13);

        // Ajout des tuiles avec protocole explicite
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap'
        }).addTo(map);

        polyline = L.polyline([], {color: '#ff0000', weight: 6}).addTo(map);
        marker = L.circleMarker([0,0], {radius: 8, color: 'blue', fillOpacity: 1}).addTo(map);
    };

    // 2. Fonction de suivi GPS
    function lancerSuivi() {
        if (!map) return;

        document.getElementById('status').innerHTML = "üõ∞Ô∏è Recherche GPS...";
        document.getElementById('btn').style.display = "none";

        map.locate({
            watch: true,
            enableHighAccuracy: false, // Utilise WiFi/R√©seau pour d√©marrer vite
            timeout: 20000
        });

        map.on('locationfound', function(e) {
            document.getElementById('status').innerHTML = "üìç Tra√ßage actif";
            document.getElementById('substatus').innerHTML = "Position capt√©e ‚úÖ";
            
            var latlng = e.latlng;
            route.push(latlng);
            polyline.setLatLngs(route);
            marker.setLatLng(latlng);
            
            map.setView(latlng, 17);
        });

        map.on('locationerror', function(e) {
            document.getElementById('status').innerHTML = "‚ö†Ô∏è Erreur Signal";
            document.getElementById('substatus').innerHTML = e.message;
            document.getElementById('btn').style.display = "block";
        });
    }
</script>

</body>
</html>
